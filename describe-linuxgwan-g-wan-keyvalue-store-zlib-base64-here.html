<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Describe linux/gwan g-wan keyvalue store zlib base64 here.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="liugehao">

    <!-- Le styles -->
    <link rel="stylesheet" href="http://liugehao.github.io/theme/css/bootstrap.min.css" type="text/css" />
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .tag-1 {
        font-size: 13pt;
      }
      .tag-2 {
        font-size: 10pt;
      }
      .tag-2 {
        font-size: 8pt;
      }
      .tag-4 {
        font-size: 6pt;
     }
    </style>
    <link href="http://liugehao.github.io/theme/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="http://liugehao.github.io/theme/css/font-awesome.css" rel="stylesheet">

    <link href="http://liugehao.github.io/theme/css/pygments.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="http://liugehao.github.io/theme/images/favicon.ico">
    <link rel="apple-touch-icon" href="http://liugehao.github.io/theme/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://liugehao.github.io/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://liugehao.github.io/theme/images/apple-touch-icon-114x114.png">

    <link href="http://liugehao.github.io/" type="application/atom+xml" rel="alternate" title="My Note Book ATOM Feed" />

  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://liugehao.github.io/index.html">My Note Book </a>
          <div class="nav-collapse">
            <ul class="nav">
                          <li class="divider-vertical"></li>
                  <li >
                    <a href="http://liugehao.github.io/category/c.html">
						<i class="icon-folder-open icon-large"></i>c
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/db.html">
						<i class="icon-folder-open icon-large"></i>db
					</a>
                  </li>
                  <li class="active">
                    <a href="http://liugehao.github.io/category/linux.html">
						<i class="icon-folder-open icon-large"></i>linux
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/linux2fe697a0e7babfe7bd91e58da1make3a202a2a2a2flib.html">
						<i class="icon-folder-open icon-large"></i>linux(2fe697a0e7babfe7bd91e58da1)make(3a202a2a2a2f)lib
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/nginx.html">
						<i class="icon-folder-open icon-large"></i>nginx
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/others.html">
						<i class="icon-folder-open icon-large"></i>Others
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/php.html">
						<i class="icon-folder-open icon-large"></i>php
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/python.html">
						<i class="icon-folder-open icon-large"></i>python
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/ruby.html">
						<i class="icon-folder-open icon-large"></i>ruby
					</a>
                  </li>
                  <li >
                    <a href="http://liugehao.github.io/category/tmp.html">
						<i class="icon-folder-open icon-large"></i>tmp
					</a>
                  </li>

                          <ul class="nav pull-right">
                                <li><a href="http://liugehao.github.io/archives.html"><i class="icon-th-list"></i>Archives</a></li>
                          </ul>

            </ul>
            <!--<p class="navbar-text pull-right">Logged in as <a href="#">username</a></p>-->
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="span9" id="content">
<section id="content">
        <article>
                <header>
                        <h1>
                                <a href=""
                                        rel="bookmark"
                                        title="Permalink to Describe linux/gwan g-wan keyvalue store zlib base64 here.">
                                        Describe linux/gwan g-wan keyvalue store zlib base64 here.
                                </a>
                        </h1>
                </header>
                <div class="entry-content">
                <div class="well">
<footer class="post-info">
<span class="label">Date</span>
<abbr class="published" title="2013-08-22T00:00:00">
        <i class="icon-calendar"></i>四 22 八月 2013
</abbr>
<span class="label">By</span>
<a href="http://liugehao.github.io/author/liugehao.html"><i class="icon-user"></i>liugehao</a>
<span class="label">Category</span>
<a href="http://liugehao.github.io/category/linux.html"><i class="icon-folder-open"></i>linux</a>.


</footer><!-- /.post-info -->                </div>
                <p>requests post数据时，进行了escape, 所以在http服务器端要unescape才是原数据。</p>
<p>file kv4.c
{{{#!highlight c</p>
<h1>include "gwan.h" // G-WAN exported functions</h1>
<h1>include <malloc.h></h1>
<h1>include <string.h></h1>
<h1>include <stdlib.h></h1>
<h1>include <base64.c></h1>
<p>typedef struct record_s // this is a user-defined 'record' structure
{
    char *content; 
    u64 tm;
} record_t;</p>
<p>int main(int argc, char <em>argv[])
{
    xbuf_t </em>reply = get_reply(argv);
    char <em>act="", </em>content="", *tm="";</p>
<div class="highlight"><pre><span class="nx">get_arg</span><span class="p">(</span><span class="s2">&quot;act=&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">act</span><span class="p">,</span> <span class="nx">argc</span><span class="p">,</span> <span class="nx">argv</span><span class="p">);</span>
<span class="nx">get_arg</span><span class="p">(</span><span class="s2">&quot;content=&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nb">content</span><span class="p">,</span> <span class="nx">argc</span><span class="p">,</span> <span class="nx">argv</span><span class="p">);</span>
<span class="nx">get_arg</span><span class="p">(</span><span class="s2">&quot;txm=&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">tm</span><span class="p">,</span> <span class="nx">argc</span><span class="p">,</span> <span class="nx">argv</span><span class="p">);</span>






<span class="nx">kv_t</span> <span class="o">**</span><span class="n">vhost_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="nx">kv_t</span><span class="o">**</span><span class="p">)</span><span class="nx">get_env</span><span class="p">(</span><span class="nx">argv</span><span class="p">,</span> <span class="nx">US_VHOST_DATA</span><span class="p">),</span> <span class="c1">//persistent ptr</span>
<span class="o">*</span><span class="n">forum_store</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//convenience pointer (var-&gt;m instead of (*var)-&gt;m)</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">vhost_ptr</span> <span class="o">&amp;&amp;</span> <span class="o">!*</span><span class="nx">vhost_ptr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="n">vhost_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="nx">kv_t</span><span class="o">*</span><span class="p">)</span><span class="nx">malloc</span><span class="p">(</span><span class="nx">sizeof</span><span class="p">(</span><span class="nx">kv_t</span><span class="p">));</span>
    <span class="nx">kv_init</span><span class="p">(</span><span class="o">*</span><span class="nx">vhost_ptr</span><span class="p">,</span> <span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span> 
<span class="n">forum_store</span> <span class="o">=</span> <span class="o">*</span><span class="nx">vhost_ptr</span><span class="p">;</span>



<span class="nx">u64</span> <span class="n">txm</span> <span class="o">=</span> <span class="nx">atof</span><span class="p">(</span><span class="nx">tm</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="nx">act</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="nx">xbuf_xcat</span><span class="p">(</span><span class="nx">reply</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">%s %s %llu&lt;br&gt;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nx">act</span><span class="p">,</span> <span class="nb">content</span><span class="p">,</span> <span class="nx">txm</span><span class="p">);</span>
    <span class="nx">kv_item</span> <span class="nb">item</span><span class="p">;</span>
    <span class="nx">record_t</span> <span class="o">*</span><span class="nx">record</span> <span class="p">;</span>
    <span class="c1">//printf(&quot;before unescape:%d\n&quot;,strlen(content));</span>
    <span class="nx">unescape_html</span><span class="p">(</span><span class="nb">content</span><span class="p">);</span>
    <span class="c1">//printf(&quot;unescaped:%d\n&quot;,strlen(content));</span>
    <span class="c1">//char tmp[strlen(content)];</span>
    <span class="c1">//printf(&quot;content:%s\n&quot;, content);</span>

    <span class="c1">//base64_decode(tmp, content, strlen(content));</span>

    <span class="c1">//printf(&quot;content(tmp):%s\n&quot;, tmp);</span>
    <span class="n">record</span> <span class="o">=</span> <span class="p">(</span><span class="nx">record_t</span><span class="o">*</span><span class="p">)</span><span class="nx">malloc</span><span class="p">(</span><span class="nx">sizeof</span><span class="p">(</span><span class="nx">record_t</span><span class="p">));</span>
    <span class="nx">record</span><span class="o">-&gt;</span><span class="nb">content</span> <span class="o">=</span> <span class="p">(</span><span class="nx">char</span><span class="o">*</span><span class="p">)</span><span class="nx">strdup</span><span class="p">(</span><span class="nb">content</span><span class="p">);</span> <span class="c1">//content ,tmp</span>
    <span class="nx">record</span><span class="o">-&gt;</span><span class="nx">tm</span> <span class="o">=</span> <span class="nx">txm</span><span class="p">;</span>
    <span class="c1">//printf(&quot;bin len:%d\n&quot;, strlen(record-&gt;content));</span>
    <span class="n">item.key</span> <span class="o">=</span> <span class="p">(</span><span class="nx">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="nx">record</span><span class="o">-&gt;</span><span class="nx">tm</span><span class="p">;</span>
    <span class="n">item.klen</span> <span class="o">=</span> <span class="nx">sizeof</span><span class="p">(</span><span class="nx">u64</span><span class="p">)</span> <span class="p">;</span><span class="c1">//sizeof(str) - 1; // faster</span>
    <span class="n">item.val</span> <span class="o">=</span> <span class="p">(</span><span class="nx">char</span><span class="o">*</span><span class="p">)</span><span class="nx">record</span><span class="p">;</span>
    <span class="n">item.flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">kv_add</span><span class="p">(</span><span class="nx">forum_store</span><span class="p">,</span> <span class="o">&amp;</span><span class="nb">item</span><span class="p">);</span> <span class="c1">// add an entry to the name_dat Store index</span>

<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="nx">act</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span> <span class="p">)</span>
<span class="p">{</span>

    <span class="nx">record_t</span> <span class="o">*</span><span class="n">record</span> <span class="o">=</span> <span class="p">(</span><span class="nx">record_t</span><span class="o">*</span><span class="p">)</span><span class="nx">kv_get</span><span class="p">(</span><span class="nx">forum_store</span><span class="p">,</span> <span class="p">(</span><span class="nx">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="nx">txm</span><span class="p">,</span> <span class="nx">sizeof</span><span class="p">(</span><span class="nx">u64</span><span class="p">));</span>
    <span class="nx">xbuf_xcat</span><span class="p">(</span><span class="nx">reply</span><span class="p">,</span>
            <span class="s2">&quot;%s&quot;</span><span class="p">,</span>
            <span class="nx">record</span> <span class="o">?</span> <span class="nx">record</span><span class="o">-&gt;</span><span class="nb">content</span> <span class="p">:</span> <span class="s2">&quot;not found&quot;</span><span class="p">);</span>

<span class="p">}</span>


<span class="c1">//xbuf_xcat(reply, &quot;&lt;br&gt;&lt;b&gt;Count&lt;/b&gt;: %d key(s) in KV store&lt;br&gt;&quot;,</span>
<span class="c1">//            forum_store-&gt;nbr_items);</span>
</pre></div>


<p>return 200; // return an HTTP code (200:'OK')</p>
<p>}</p>
<p>}}}
python file:
{{{#!highlight python</p>
<h1>!/usr/bin/env python</h1>
<h1>-<em>- coding: utf-8 -</em>-</h1>
<p>import MySQLdb, zlib, requests, os, base64</p>
<p>conn = MySQLdb.connect(host='127.0.0.1', user='root', passwd='liuyou', db='base')
cur1 =conn.cursor()</p>
<h1>cur1.execute("select distinct tm from smi limit 1000000;")</h1>
<p>tmp = "".join(os.popen('mysql -h localhost -uroot -pliuyou base --execute="select * from smi limit 10000,10"', 'r').readlines()[1:])
tmp = tmp.replace("\t0\t","\t\t").replace("\t0\t","\t\t").replace("\t0.0000\t","\t\t").replace("0000-00-00 00:00:00","")
tmp = zlib.compress(tmp, 9)
"""
print "\n%s\n" % tmp
tmp1 = zlib.compress(tmp, 9)
print "\n%s\n" % tmp1
tmp = base64.b64encode(tmp1)
print "\n%s\n" % tmp
print zlib.decompress(base64.b64decode(tmp))</p>
<h1>tmp = zlib.compress(tmp, 9)</h1>
<h1>tmp = zlib.compress(str(os.popen('mysql -h localhost -uroot -pliuyou base --execute="select * from smi limit 10000,10"', 'r').readlines()[1:]))</h1>
<p>"""</p>
<h1>while 1:</h1>
<div class="highlight"><pre><span class="c">#row = cur1.fetchone()</span>
<span class="c">#if row is None:</span>
<span class="c">#    break</span>
<span class="c">#print row[0]</span>
</pre></div>


<p>for i in xrange(1,100000):
    print i,len(tmp)
    requests.post("http://127.0.0.1:8080/?kv4.c&amp;act=a&amp;txm=%d" % i, data={
        "content": tmp
    },timeout=3 , verify=False)
}}}</p>
<p>base64.c
{{{#!highlight c</p>
<h1>include <string.h></h1>
<p>char b64string[] =
    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";</p>
<p>long base64_encode (to, from, len)
    char <em>to, </em>from;
    unsigned int len;
{
    char <em>fromp = from;
    char </em>top = to;
    unsigned char cbyte;
    unsigned char obyte;
    char end[3];</p>
<div class="highlight"><pre><span class="k">for</span> <span class="p">(;</span> <span class="n">len</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">len</span> <span class="o">-=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">;</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)(</span><span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)];</span>
    <span class="n">obyte</span> <span class="o">=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x30</span><span class="p">;</span>        <span class="cm">/* 0011 0000 */</span>

    <span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">;</span>
    <span class="n">obyte</span> <span class="o">|=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>          <span class="cm">/* 0000 1111 */</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">obyte</span><span class="p">];</span>
    <span class="n">obyte</span> <span class="o">=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3C</span><span class="p">;</span>        <span class="cm">/* 0011 1100 */</span>

    <span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">;</span>
    <span class="n">obyte</span> <span class="o">|=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">);</span>          <span class="cm">/* 0000 0011 */</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">obyte</span><span class="p">];</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)(</span><span class="n">cbyte</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">)];</span><span class="cm">/* 0011 1111 */</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">len</span><span class="p">)</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">;</span> <span class="k">else</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">end</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">cbyte</span> <span class="o">=</span> <span class="n">end</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)(</span><span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)];</span>
    <span class="n">obyte</span> <span class="o">=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x30</span><span class="p">;</span>        <span class="cm">/* 0011 0000 */</span>

    <span class="n">cbyte</span> <span class="o">=</span> <span class="n">end</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">obyte</span> <span class="o">|=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">obyte</span><span class="p">];</span>
    <span class="n">obyte</span> <span class="o">=</span> <span class="p">(</span><span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3C</span><span class="p">;</span>        <span class="cm">/* 0011 1100 */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">b64string</span><span class="p">[(</span><span class="kt">int</span><span class="p">)</span><span class="n">obyte</span><span class="p">];</span>
    <span class="k">else</span> <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;=&#39;</span><span class="p">;</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;=&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">*</span><span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">return</span> <span class="n">top</span> <span class="o">-</span> <span class="n">to</span><span class="p">;</span>
</pre></div>


<p>}</p>
<p>/<em> badchar(): check if c is decent; puts either the </em>/
/<em> location of c or null into p.                  </em>/</p>
<h1>define badchar(c,p) (!(p = memchr(b64string, c, 64)))</h1>
<p>long base64_decode (to, from, len)
    char <em>to, </em>from;
    unsigned int len;
{
    char <em>fromp = from;
    char </em>top = to;
    char *p;
    unsigned char cbyte;
    unsigned char obyte;
    int padding = 0;</p>
<div class="highlight"><pre><span class="k">for</span> <span class="p">(;</span> <span class="n">len</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">len</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="p">)</span> <span class="n">cbyte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">badchar</span><span class="p">(</span><span class="n">cbyte</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">cbyte</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">b64string</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">obyte</span> <span class="o">=</span> <span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>     <span class="cm">/* 1111 1100 */</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="p">)</span> <span class="n">cbyte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">badchar</span><span class="p">(</span><span class="n">cbyte</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">cbyte</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">b64string</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">obyte</span> <span class="o">|=</span> <span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>        <span class="cm">/* 0000 0011 */</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">obyte</span><span class="p">;</span>

    <span class="n">obyte</span> <span class="o">=</span> <span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>     <span class="cm">/* 1111 0000 */</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="n">cbyte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">padding</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">badchar</span> <span class="p">(</span><span class="n">cbyte</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">cbyte</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">b64string</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">obyte</span> <span class="o">|=</span> <span class="n">cbyte</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>        <span class="cm">/* 0000 1111 */</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">obyte</span><span class="p">;</span>

    <span class="n">obyte</span> <span class="o">=</span> <span class="n">cbyte</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">;</span>     <span class="cm">/* 1100 0000 */</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">cbyte</span> <span class="o">=</span> <span class="o">*</span><span class="n">fromp</span><span class="o">++</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;=&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="n">cbyte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">padding</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">badchar</span> <span class="p">(</span><span class="n">cbyte</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">cbyte</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">b64string</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">obyte</span> <span class="o">|=</span> <span class="n">cbyte</span><span class="p">;</span>         <span class="cm">/* 0011 1111 */</span>
    <span class="o">*</span><span class="n">top</span><span class="o">++</span> <span class="o">=</span> <span class="n">obyte</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">*</span><span class="n">top</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="k">return</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">to</span><span class="p">)</span> <span class="o">-</span> <span class="n">padding</span><span class="p">;</span>
</pre></div>


<p>}</p>
<p>}}}</p>
                </div><!-- /.entry-content -->
                <div class="comments">
                <h2>Comments !</h2>
                        <div id="disqus_thread"></div>
                        <script type="text/javascript">
                           var disqus_identifier = "describe-linuxgwan-g-wan-keyvalue-store-zlib-base64-here.html";
                           (function() {
                                var dsq = document.createElement('script');
                                dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = 'http://liugehaonotebook.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] ||
                                 document.getElementsByTagName('body')[0]).appendChild(dsq);
                          })();
                        </script>
                </div>
        </article>
</section>
        </div><!--/span-->

                <div class="span3 well sidebar-nav" id="sidebar">
<ul class="nav nav-list">
<li class="nav-header"><h4><i class="icon-external-link"></i>blogroll</h4></li>
    <li><a href="http://getpelican.com/"><i class="icon-external-link"></i>Pelican</a></li>
    <li><a href="http://python.org/"><i class="icon-external-link"></i>Python.org</a></li>
    <li><a href="http://jinja.pocoo.org/"><i class="icon-external-link"></i>Jinja2</a></li>
    <li><a href="#"><i class="icon-external-link"></i>You can modify those links in your config file</a></li>
<li class="nav-header"><h4><i class="icon-home icon-large"></i> social</h4></li>
<li><a href="http://liugehao.github.io/" rel="alternate"><i class="icon-bookmark icon-large"></i>atom feed</a></li>
    <li><a href="#"><i class="icon-You can add links in your config file-sign icon-large"></i>You can add links in your config file</a></li>
    <li><a href="#"><i class="icon-Another social link-sign icon-large"></i>Another social link</a></li>

<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
<li>
<a href="http://liugehao.github.io/category/c.html">
    <i class="icon-folder-open icon-large"></i>c
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/db.html">
    <i class="icon-folder-open icon-large"></i>db
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/linux.html">
    <i class="icon-folder-open icon-large"></i>linux
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/linux2fe697a0e7babfe7bd91e58da1make3a202a2a2a2flib.html">
    <i class="icon-folder-open icon-large"></i>linux(2fe697a0e7babfe7bd91e58da1)make(3a202a2a2a2f)lib
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/nginx.html">
    <i class="icon-folder-open icon-large"></i>nginx
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/others.html">
    <i class="icon-folder-open icon-large"></i>Others
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/php.html">
    <i class="icon-folder-open icon-large"></i>php
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/python.html">
    <i class="icon-folder-open icon-large"></i>python
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/ruby.html">
    <i class="icon-folder-open icon-large"></i>ruby
</a>
</li>
<li>
<a href="http://liugehao.github.io/category/tmp.html">
    <i class="icon-folder-open icon-large"></i>tmp
</a>
</li>

<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>


</ul>        </div><!--/.well -->

      </div><!--/row-->

      <hr>

      <footer>
        <address id="about">
                Proudly powered by <a href="http://pelican.notmyidea.org/">Pelican <i class="icon-external-link"></i></a>,
                                which takes great advantage of <a href="http://python.org">Python <i class="icon-external-link"></i></a>.
        </address><!-- /#about -->

        <p>The theme is from <a href="http://twitter.github.com/bootstrap/">Bootstrap from Twitter <i class="icon-external-link"></i></a>,
                   and <a href="http://fortawesome.github.com/Font-Awesome/">Font-Awesome <i class="icon-external-link"></i></a>, thanks!</p>
      </footer>

    </div><!--/.fluid-container-->


<script type="text/javascript">
    var disqus_shortname = 'liugehaonotebook';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- Le javascript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://liugehao.github.io/theme/js/jquery-1.7.2.min.js"></script>
    <script src="http://liugehao.github.io/theme/js/bootstrap.min.js"></script>
  </body>
</html>